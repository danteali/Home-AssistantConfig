####################################################################################################
# Zigbee2mqtt Devices
####################################################################################################

# Sources:
# https://www.zigbee2mqtt.io/integration/home_assistant.html

# If adding new devices:
# - View log while adding device to config it is registered by USB dongle
# - Copy zigbee2mqtt configuration.yaml to configuration.yaml2
# - Edit new device friendly name
# - Stop zigbee2mqtt container
# - copy configuration.yaml2 back on top of configuration.yaml
# - Search for new device in HA Entities list
# - Edit entity name in HA to make sure it lines up with zigbee2mqtt friendly name

#===================================================================================================
# Groups
#---------------------------------------------------------------------------------------------------
# https://www.home-assistant.io/components/group/
# Icons: https://materialdesignicons.com/
#
# If not using custom Lovelace, groups can be shown in the main dashboard or tabs at the top of the
# overview screen (set 'view: true').
# Groups with actions associated (e.g. switches) will have a group-wide switch at the top by default
# unless we set 'control: hidden'.
# Groups can be referenced as part of other groups too.
#===================================================================================================

group:
  zigbee2mqtt:
    name: Zigbee2MQTT Devices
    view: false
    control: hidden
    icon: mdi:zigbee
    entities:
      - switch.ikea_outlet_htpc_switch
      - sensor.ikea_outlet_htpc_linkquality
      - sensor.ikea_5button_action
      - binary_sensor.ikea_motiondetector_occupancy
      - sensor.ikea_switch_click
      - light.ikea_bulb_wh_light
      - switch.ikea_outlet_switch
      - sensor.ikea_motiondetector_battery
      - sensor.ikea_switch_battery
      - sensor.ikea_5button_linkquality
      - sensor.ikea_motiondetector_linkquality
      - sensor.ikea_switch_linkquality      
      - sensor.ikea_bulb_wh_linkquality
      - sensor.ikea_outlet_linkquality


#===================================================================================================
# Automation
#---------------------------------------------------------------------------------------------------
# https://www.home-assistant.io/components/automation/
# https://www.home-assistant.io/docs/automation/examples/
# https://www.home-assistant.io/docs/automation/templating/
#===================================================================================================

# Will create automations in node red
#automation:
#  - id: zigbee2mqtt_test_ikea5button
#    alias: Test - Zigbee2mqtt - Ikea 5 Button clicks
#    initial_state: false
#    hide_entity: true  
#    trigger:
#      - platform: state
#        entity_id: sensor.ikea_5button_action
#        from: ''
#    action:
#      - service: persistent_notification.create
#        data_template:
#          notification_id: zigbee2mqtt_test_ikea5button1_to
#          message: >
#            You clicked {{ trigger.to_state.state }}
#          title: Tradfri Clicked - To State
#      - service: persistent_notification.create
#        data_template:
#          notification_id: zigbee2mqtt_test_ikea5button_from
#          message: >
#            You clicked {{ trigger.from_state.state }}
#          title: Tradfri Clicked - From State
#
#  - id: zigbee2mqtt_test_motion_on
#    alias: Test - Zigbee2mqtt - Motion On
#    initial_state: false
#    hide_entity: true  
#    trigger:
#      - platform: state
#        entity_id: binary_sensor.ikea_motiondetector_occupancy
#        to: 'on'
#    action:
#      - service: persistent_notification.create
#        data:
#          notification_id: zigbee2mqtt_test_motion_to
#          message: Motion Detected
#          title: Tradfri Motion Detected
#
##https://www.home-assistant.io/cookbook/turn_on_light_for_10_minutes_when_motion_detected/
#  - id: zigbee2mqtt_test_motion_off_timed
#    alias: Test - Zigbee2mqtt - Motion Off - Timed
#    initial_state: false
#    hide_entity: true  
#    trigger:
#      platform: state
#      entity_id: binary_sensor.ikea_motiondetector_occupancy
#      to: 'off'
#      for:
#        minutes: 10
#    action:
#      - service: persistent_notification.create
#        data:
#          notification_id: zigbee2mqtt_test_motion_off_timed
#          message: Motion Off - Timed 10 min
#          title: Tradfri Motion Off - Timed
#
#  - id: zigbee2mqtt_test_motion_off
#    alias: Test - Zigbee2mqtt - Motion Off
#    initial_state: false
#    hide_entity: true  
#    trigger:
#      - platform: state
#        entity_id: binary_sensor.ikea_motiondetector_occupancy
#        to: 'off'
#    action:
#      - service: persistent_notification.create
#        data:
#          notification_id: zigbee2mqtt_test_motion_off
#          message: Motion Off
#          title: Tradfri Motion Off

# State - Specific Button
#  - id: zigbee2mqtt_test_ikea5button
#    alias: Test - Zigbee2mqtt - Ikea 5 Button clicks
#    initial_state: True
#    hide_entity: true  
#    trigger:
#      - platform: state
#        entity_id: sensor.ikea_5button_action
#        to: 'arrow_right_click'
#    action:
#      - service: persistent_notification.create
#        data_template:
#          notification_id: zigbee2mqtt_test_ikea5button1_to
#          message: >
#            You clicked {{ trigger.to_state.state }}
#          title: Tradfri Clicked - To State

# MQTT - For specific button actions
#  - id: zigbee2mqtt_test_ikea5button
#    alias: Test - Zigbee2mqtt - Ikea 5 Button clicks
#    initial_state: True
#    hide_entity: true  
#    trigger:
#      - platform: mqtt
#        topic: 'zigbee2mqtt/ikea_5button'
#    condition:
#      - condition: template
#        value_template: '{{ "toggle" == trigger.payload_json.action }}'
#    action:
#      - service: persistent_notification.create
#        data:
#          notification_id: zigbee2mqtt_test_ikea5button
#          message: Button Clicked
#          title: Zigbee2mqtt Test

# MQTT - For any button
#  - id: zigbee2mqtt_test_ikea5button2
#    alias: Test - Zigbee2mqtt - Ikea 5 Button clicks - MQTT
#    initial_state: True
#    hide_entity: true  
#    trigger:
#      - platform: mqtt
#        topic: 'zigbee2mqtt/ikea_5button'
#    action:
#      - service: persistent_notification.create
#        data_template:
#          notification_id: zigbee2mqtt_test_ikea5button_mqtt
#          message: '{{ trigger.payload }}'
#          title: Zigbee2mqtt Test - MQTT
